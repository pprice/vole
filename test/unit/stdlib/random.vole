// Tests for std:random module

let random = import "std:random"

tests "random float" {
    test "float returns value in range" {
        let f = random.float()
        assert(f >= 0.0)
        assert(f < 1.0)
    }

    test "float varies" {
        // Get multiple values and check they're not all the same
        let f1 = random.float()
        let f2 = random.float()
        let f3 = random.float()
        let f4 = random.float()
        let f5 = random.float()
        // At least one pair should be different
        let all_same = f1 == f2 && f2 == f3 && f3 == f4 && f4 == f5
        assert(!all_same)
    }

    test "many floats in range" {
        let mut i = 0
        while i < 100 {
            let f = random.float()
            assert(f >= 0.0)
            assert(f < 1.0)
            i = i + 1
        }
    }
}

tests "random int" {
    test "int returns value in range" {
        let n = random.int(1, 10)
        assert(n >= 1)
        assert(n <= 10)
    }

    test "int with same min and max" {
        let n = random.int(5, 5)
        assert(n == 5)
    }

    test "int with negative range" {
        let n = random.int(-10, -5)
        assert(n >= -10)
        assert(n <= -5)
    }

    test "int with zero crossing range" {
        let n = random.int(-5, 5)
        assert(n >= -5)
        assert(n <= 5)
    }

    test "many ints in range" {
        let mut i = 0
        while i < 100 {
            let n = random.int(0, 100)
            assert(n >= 0)
            assert(n <= 100)
            i = i + 1
        }
    }
}

tests "random coin" {
    test "coin returns true or false" {
        // Run many times - should get both values
        let mut got_true = false
        let mut got_false = false
        let mut i = 0
        while i < 100 {
            if random.coin() {
                got_true = true
            } else {
                got_false = true
            }
            i = i + 1
        }
        // Should have gotten both values in 100 tries
        assert(got_true)
        assert(got_false)
    }
}

tests "seeded rng" {
    test "seeded returns consistent floats" {
        let rng1 = random.seeded(42)
        let rng2 = random.seeded(42)
        let f1_1 = random.rng_float(rng1)
        let f1_2 = random.rng_float(rng1)
        let f1_3 = random.rng_float(rng1)
        let f2_1 = random.rng_float(rng2)
        let f2_2 = random.rng_float(rng2)
        let f2_3 = random.rng_float(rng2)
        assert(f1_1 == f2_1)
        assert(f1_2 == f2_2)
        assert(f1_3 == f2_3)
    }

    test "seeded different seeds different values" {
        let rng1 = random.seeded(1)
        let rng2 = random.seeded(2)
        let f1 = random.rng_float(rng1)
        let f2 = random.rng_float(rng2)
        assert(f1 != f2)
    }

    test "seeded int in range" {
        let rng = random.seeded(123)
        let mut i = 0
        while i < 100 {
            let n = random.rng_int(rng, 10, 20)
            assert(n >= 10)
            assert(n <= 20)
            i = i + 1
        }
    }

    test "seeded coin varies" {
        let rng = random.seeded(456)
        let mut got_true = false
        let mut got_false = false
        let mut i = 0
        while i < 100 {
            if random.rng_coin(rng) {
                got_true = true
            } else {
                got_false = true
            }
            i = i + 1
        }
        assert(got_true)
        assert(got_false)
    }

    test "seeded float in range" {
        let rng = random.seeded(789)
        let mut i = 0
        while i < 100 {
            let f = random.rng_float(rng)
            assert(f >= 0.0)
            assert(f < 1.0)
            i = i + 1
        }
    }
}
