tests "string interpolation" {
    test "simple variable" {
        let name = "world"
        let s = "hello, {name}"
        assert(s == "hello, world")
    }

    test "expression" {
        let a = 2
        let b = 3
        let s = "sum is {a + b}"
        assert(s == "sum is 5")
    }

    test "multiple interpolations" {
        let x = 1
        let y = 2
        let s = "{x} + {y} = {x + y}"
        assert(s == "1 + 2 = 3")
    }

    test "empty text segments" {
        let x = 42
        let s = "{x}"
        assert(s == "42")
    }

    test "nested expressions" {
        let arr = [1, 2, 3]
        let s = "first: {arr[0]}, length: {arr.length()}"
        assert(s == "first: 1, length: 3")
    }

    test "integer" {
        let n = 42
        let s = "number: {n}"
        assert(s == "number: 42")
    }

    test "float" {
        let f = 3.14
        let s = "pi: {f}"
        assert(s == "pi: 3.14")
    }

    test "boolean true" {
        let b = true
        let s = "value: {b}"
        assert(s == "value: true")
    }

    test "boolean false" {
        let b = false
        let s = "value: {b}"
        assert(s == "value: false")
    }

    test "nil value" {
        let x: i32? = nil
        let s = "value: {x}"
        assert(s == "value: nil")
    }

    test "array small" {
        let arr = [1, 2, 3]
        let s = "arr: {arr}"
        assert(s == "arr: [1, 2, 3]")
    }

    test "array truncated" {
        let arr = [1, 2, 3, 4, 5, 6, 7]
        let s = "arr: {arr}"
        assert(s == "arr: [1, 2, 3, 4, 5, ...]")
    }

    test "escaped braces" {
        let s = "literal {{braces}}"
        assert(s == "literal {{braces}}")
    }

    test "backslash escaped braces are literal" {
        let s = "literal \{braces\}"
        assert(s == "literal \{braces\}")
    }

    test "method call in interpolation" {
        let arr = [1, 2, 3, 4, 5]
        let s = "length: {arr.length()}"
        assert(s == "length: 5")
    }
}

tests "raw strings" {
    test "basic" {
        let s = @"hello"
        assert(s == "hello")
    }

    test "with braces not interpolated" {
        let s = @"{not interpolated}"
        assert(s.length() == 18)
    }

    test "with backslash" {
        let s = @"path\to\file"
        assert(s.length() == 12)
    }

    test "regex pattern" {
        let pattern = @"^\d{3}-\d{4}$"
        assert(pattern.length() == 13)
    }
}
