// Test: Probing generic Map<K, V> support
// Prefixed with _ to skip by default

// Simple generic container to test class-level generics
class Container<T> {
    value: T,

    statics {
        func new(v: T) -> Container<T> {
            return Container { value: v }
        }
    }

    func get() -> T {
        return self.value
    }
}

// Generic container with constraint
class HashContainer<T: Hashable> {
    value: T,

    statics {
        func new(v: T) -> HashContainer<T> {
            return HashContainer { value: v }
        }
    }

    func get() -> T {
        return self.value
    }

    func get_hash() -> i64 {
        return self.value.hash()
    }
}

tests {
    test "simple generic container with i64" {
        let c = Container.new(42)
        assert(c.get() == 42)
    }

    test "simple generic container with string" {
        let c = Container.new("hello")
        assert(c.get() == "hello")
    }

    test "constrained generic container with i64" {
        let c = HashContainer.new(42)
        assert(c.get() == 42)
        assert(c.get_hash() == 42.hash())
    }

    test "constrained generic container with string" {
        let c = HashContainer.new("hello")
        assert(c.get() == "hello")
        // String should be hashable
        let h = c.get_hash()
        assert(h != 0)
    }
}
