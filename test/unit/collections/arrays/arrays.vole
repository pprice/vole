// Array tests

tests "arrays" {
    test "literal" {
        let arr = [1, 2, 3]
        assert(arr[0] == 1)
        assert(arr[1] == 2)
        assert(arr[2] == 3)
    }

    test "length" {
        let arr = [1, 2, 3, 4, 5]
        assert(arr.length() == 5)
    }

    test "empty array length" {
        let arr: [i64] = []
        assert(arr.length() == 0)
    }

    test "for iteration" {
        var sum = 0
        for x in [1, 2, 3] {
            sum = sum + x
        }
        assert(sum == 6)
    }

    test "nested arrays" {
        let arr = [[1, 2], [3, 4]]
        assert(arr[0][0] == 1)
        assert(arr[1][1] == 4)
    }

    test "boundary access" {
        let arr = [10, 20, 30]
        assert(arr[0] == 10)
        assert(arr[2] == 30)
        assert(arr.length() == 3)
    }

    test "single element array" {
        let arr = [42]
        assert(arr[0] == 42)
        assert(arr.length() == 1)
    }

    test "i128 literal and index preserve wide values" {
        let a = 1_i128 << 64
        let b = 1_i128 << 63
        let xs: [i128] = [a, b, 3_i128]
        assert(xs[0] == a)
        assert(xs[1] == b)
        assert(xs[2] == 3_i128)
    }

    test "i128 index assignment preserves neighbors" {
        var xs: [i128] = [0_i128, 1_i128, 2_i128]
        let big = (1_i128 << 64) + 77_i128
        xs[1] = big
        assert(xs[0] == 0_i128)
        assert(xs[1] == big)
        assert(xs[2] == 2_i128)
    }

    test "f128 literal and index assignment" {
        var xs: [f128] = [1.25_f128, 2.5_f128, 3.75_f128]
        assert(xs[1] == 2.5_f128)
        xs[1] = 42.5_f128
        assert(xs[0] == 1.25_f128)
        assert(xs[1] == 42.5_f128)
        assert(xs[2] == 3.75_f128)
    }

    test "for iteration over i128 array" {
        let xs: [i128] = [1_i128 << 64, 5_i128]
        var sum: i128 = 0_i128
        for x in xs {
            sum = sum + x
        }
        assert(sum == (1_i128 << 64) + 5_i128)
    }
}
