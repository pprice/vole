// Test: Basic Map operations (i64 keys and values)
// Note: Iterator methods temporarily excluded until RuntimeIterator codegen is fixed

tests {
    test "map::new creates empty map" {
        let m = Map.new<i64, i64>()
        assert(m.len() == 0)
        assert(m.is_empty())
    }

    test "map::set and get" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)
        m.set(2, 200)

        assert(m.len() == 2)
        assert(m.get(1) == 100)
        assert(m.get(2) == 200)
    }

    test "map::get returns nil for missing key" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)

        assert(m.get(1) == 100)
        assert(m.get(999) == nil)
    }

    test "map::contains_key" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)

        assert(m.contains_key(1))
        assert(!m.contains_key(2))
    }

    test "map::remove" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)
        m.set(2, 200)

        let removed = m.remove(1)
        assert(removed == 100)
        assert(m.len() == 1)
        assert(!m.contains_key(1))
        assert(m.contains_key(2))
    }

    test "map::remove missing key returns nil" {
        let m = Map.new<i64, i64>()
        assert(m.remove(999) == nil)
    }

    test "map::clear" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)
        m.set(2, 200)

        m.clear()
        assert(m.len() == 0)
        assert(m.is_empty())
    }

    test "map::update existing key" {
        let m = Map.new<i64, i64>()
        m.set(1, 100)
        m.set(1, 999)

        assert(m.len() == 1)
        assert(m.get(1) == 999)
    }

    test "map::with_capacity" {
        let m = Map.with_capacity<i64, i64>(100)
        assert(m.len() == 0)
        assert(m.is_empty())
        m.set(1, 10)
        assert(m.len() == 1)
        assert(m.get(1) == 10)
    }

    test "map::keys count" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        m.set(3, 30)
        assert(m.keys().count() == 3)
    }

    test "map::values count" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        m.set(3, 30)
        assert(m.values().count() == 3)
    }

    test "map::entries count" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        assert(m.entries().count() == 2)
    }

    test "map::iter count" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        m.set(3, 30)
        assert(m.iter().count() == 3)
    }

    test "map::keys for-in loop" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        m.set(3, 30)
        let mut sum = 0
        for k in m.keys() {
            sum = sum + k
        }
        assert(sum == 6)
    }

    test "map::values for-in loop" {
        let m = Map.new<i64, i64>()
        m.set(1, 10)
        m.set(2, 20)
        m.set(3, 30)
        let mut sum = 0
        for v in m.values() {
            sum = sum + v
        }
        assert(sum == 60)
    }

    test "map::iter on empty map" {
        let m = Map.new<i64, i64>()
        assert(m.keys().count() == 0)
        assert(m.values().count() == 0)
        assert(m.entries().count() == 0)
        assert(m.iter().count() == 0)
    }
}
