// Annotation type tests - @annotation marks types usable as annotations

// Define custom annotation types
@annotation
struct deprecated {}

@annotation
struct inline {}

@annotation
struct tag {
    name: string,
}

// Use annotations on functions
@deprecated
func old_helper() -> i64 {
    return 42
}

// Use annotations on structs
@deprecated
struct LegacyData {
    value: i64,
}

// Use annotations on classes
@deprecated
class OldService {
    data: i64,

    func get_data(self: Self) -> i64 {
        return self.data
    }
}

// Use annotations on interfaces
@deprecated
interface Obsolete {
    func do_thing(self: Self) -> i64
}

// Multiple annotations on one declaration
@deprecated
@inline
func doubly_annotated() -> i64 {
    return 99
}

// Annotation with arguments
@tag(name: "important")
func tagged_func() -> i64 {
    return 100
}

// Use annotations on fields
struct AnnotatedPoint {
    @tag(name: "x_coord")
    x: i64,
    @deprecated
    y: i64,
}

// Multiple annotations on one field
class AnnotatedService {
    @deprecated
    @tag(name: "old_data")
    data: i64,

    func get_data(self: Self) -> i64 {
        return self.data
    }
}

// Positional args on field annotation
struct PositionalAnnotated {
    @tag("pos_field")
    value: i64,
}

// Verify annotated declarations still work normally at runtime
tests "annotation basics" {
    test "annotated function works normally" {
        assert(old_helper() == 42)
    }

    test "annotated struct works normally" {
        let d = LegacyData { value: 10 }
        assert(d.value == 10)
    }

    test "annotated class works normally" {
        let svc = OldService { data: 7 }
        assert(svc.get_data() == 7)
    }

    test "multiply annotated function works" {
        assert(doubly_annotated() == 99)
    }

    test "annotation with args function works" {
        assert(tagged_func() == 100)
    }

    test "annotated field struct works normally" {
        let p = AnnotatedPoint { x: 3, y: 4 }
        assert(p.x == 3)
        assert(p.y == 4)
    }

    test "annotated field class works normally" {
        let svc = AnnotatedService { data: 42 }
        assert(svc.get_data() == 42)
    }

    test "positional arg annotation on field works" {
        let v = PositionalAnnotated { value: 7 }
        assert(v.value == 7)
    }
}
