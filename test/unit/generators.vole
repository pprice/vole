// Generator tests: parameter access in yield expressions

func gen_single(a: i64) -> Iterator<i64> {
    yield a
}

func gen_multi_params(a: i64, b: i64) -> Iterator<i64> {
    yield a
    yield b
    yield a + b
}

func gen_literal() -> Iterator<i64> {
    yield 10
    yield 20
}

tests {
    test "generator yields literal values" {
        let it = gen_literal()
        let r1 = it.next()
        assert(r1 is i64)
        if r1 is i64 {
            assert(r1 == 10)
        }
        let r2 = it.next()
        assert(r2 is i64)
        if r2 is i64 {
            assert(r2 == 20)
        }
        let r3 = it.next()
        assert(r3 is Done)
    }

    test "generator yields parameter value" {
        let it = gen_single(42)
        let r1 = it.next()
        assert(r1 is i64)
        if r1 is i64 {
            assert(r1 == 42)
        }
        let r2 = it.next()
        assert(r2 is Done)
    }

    test "generator yields multiple parameters" {
        let it = gen_multi_params(10, 20)
        let r1 = it.next()
        assert(r1 is i64)
        if r1 is i64 {
            assert(r1 == 10)
        }
        let r2 = it.next()
        assert(r2 is i64)
        if r2 is i64 {
            assert(r2 == 20)
        }
        let r3 = it.next()
        assert(r3 is i64)
        if r3 is i64 {
            assert(r3 == 30)
        }
        let r4 = it.next()
        assert(r4 is Done)
    }

    test "generator with different argument values" {
        let it1 = gen_single(100)
        let r1 = it1.next()
        assert(r1 is i64)
        if r1 is i64 {
            assert(r1 == 100)
        }

        let it2 = gen_single(200)
        let r2 = it2.next()
        assert(r2 is i64)
        if r2 is i64 {
            assert(r2 == 200)
        }
    }
}
