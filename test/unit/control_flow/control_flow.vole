// Control flow tests

tests "if" {
    test "simple if true" {
        var x = 0
        if true { x = 1 }
        assert(x == 1)
    }

    test "simple if false" {
        var x = 0
        if false { x = 1 }
        assert(x == 0)
    }

    test "if else true" {
        var x = 0
        if true { x = 1 } else { x = 2 }
        assert(x == 1)
    }

    test "if else false" {
        var x = 0
        if false { x = 1 } else { x = 2 }
        assert(x == 2)
    }

    test "if condition expression" {
        let a = 10
        let b = 5
        var x = 0
        if a > b { x = 1 }
        assert(x == 1)
    }
}

tests "else-if chains" {
    test "first branch matches" {
        var result = ""
        if 10 > 5 {
            result = "big"
        } else if 10 > 0 {
            result = "small"
        }
        assert(result == "big")
    }

    test "second branch matches" {
        var result = ""
        if 3 > 5 {
            result = "big"
        } else if 3 > 0 {
            result = "small"
        }
        assert(result == "small")
    }

    test "else branch negative" {
        var result = ""
        if -5 > 0 {
            result = "positive"
        } else if -5 < 0 {
            result = "negative"
        } else {
            result = "zero"
        }
        assert(result == "negative")
    }

    test "else branch zero" {
        var result = ""
        if 0 > 0 {
            result = "positive"
        } else if 0 < 0 {
            result = "negative"
        } else {
            result = "zero"
        }
        assert(result == "zero")
    }
}

tests "while" {
    test "simple while" {
        var i = 0
        var sum = 0
        while i < 5 {
            sum = sum + i
            i = i + 1
        }
        assert(sum == 10)
    }

    test "while never runs" {
        var x = 0
        while false { x = 1 }
        assert(x == 0)
    }
}

tests "for" {
    test "for over array" {
        var sum = 0
        for x in [1, 2, 3, 4, 5] {
            sum = sum + x
        }
        assert(sum == 15)
    }

    test "for empty array" {
        var x = 0
        for i in [] {
            x = 1
        }
        assert(x == 0)
    }

    test "exclusive range" {
        // 0..3 = 0, 1, 2
        var sum = 0
        for i in 0..3 {
            sum = sum + i
        }
        assert(sum == 3)
    }

    test "inclusive range" {
        // 0..=3 = 0, 1, 2, 3
        var sum = 0
        for j in 0..=3 {
            sum = sum + j
        }
        assert(sum == 6)
    }

    test "nested ranges" {
        var count = 0
        for x in 0..2 {
            for y in 0..3 {
                count = count + 1
            }
        }
        assert(count == 6)
    }
}
