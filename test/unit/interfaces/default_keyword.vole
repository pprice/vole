// Test 'default' keyword syntax for interface methods
// This tests the parsing of 'default func' and 'default external'

interface Counter {
    // Abstract method - no default keyword, no body
    func value() -> i64

    // Default method - has 'default' keyword and body
    default func increment() -> i64 {
        return self.value() + 1
    }

    // Another default method
    default func decrement() -> i64 {
        return self.value() - 1
    }

    // Abstract method - no default keyword, no body
    func reset() -> i64
}

class SimpleCounter implements Counter {
    current: i64,

    func value() -> i64 {
        return self.current
    }

    func reset() -> i64 {
        return 0
    }
}

// Counter that overrides a default method
class CustomCounter implements Counter {
    current: i64,

    func value() -> i64 {
        return self.current
    }

    func reset() -> i64 {
        return 0
    }

    // Override the default increment to add 10 instead of 1
    func increment() -> i64 {
        return self.value() + 10
    }
}

tests "default keyword parsing" {
    test "default method can call abstract method" {
        let c = SimpleCounter { current: 10 }
        assert(c.value() == 10)
        assert(c.increment() == 11)
        assert(c.decrement() == 9)
    }

    test "default method through interface type" {
        // Call default method through interface-typed variable (vtable dispatch)
        let c: Counter = SimpleCounter { current: 5 }
        assert(c.value() == 5)
        assert(c.increment() == 6)
        assert(c.decrement() == 4)
    }

    test "override default method" {
        // CustomCounter overrides increment() to add 10 instead of 1
        let c = CustomCounter { current: 5 }
        assert(c.value() == 5)
        assert(c.increment() == 15)  // Overridden: +10
        assert(c.decrement() == 4)   // Still uses default: -1
    }

    test "override default method through interface type" {
        // Vtable should use the overridden implementation
        let c: Counter = CustomCounter { current: 5 }
        assert(c.value() == 5)
        assert(c.increment() == 15)  // Overridden: +10
        assert(c.decrement() == 4)   // Still uses default: -1
    }
}
