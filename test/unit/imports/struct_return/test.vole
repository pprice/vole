// Test cross-module function calls that return structs.
// Verifies that sret (struct return) calling convention works correctly
// when calling functions across module boundaries via method-call syntax.

let lib = import "./lib"

tests {
    test "cross-module small struct return (multi-value)" {
        let s = lib.make_small(10_i32, 20_i64)
        assert(s.x == 10_i32)
        assert(s.y == 20_i64)
    }

    test "cross-module big struct return (sret)" {
        let s = lib.make_big(true, "hello", 42_i64)
        assert(s.field1 == 42_i64)
        assert(s.field3 == 42_i32)
        assert(s.field4 == true)
    }

    test "cross-module big struct with string return (sret)" {
        let s = lib.make_big_with_string("test", 77_i64)
        assert(s.name == "test")
        assert(s.value == 77_i64)
        assert(s.flag == true)
        assert(s.count == 99_i32)
    }

    test "cross-module sret result used in expression" {
        let s = lib.make_big(false, "world", 100_i64)
        let sum = s.field1 + s.field3
        assert(sum == 142_i64)
    }
}
