// Runtime type checking with 'is' operator

class Point {
    x: i32,
    y: i32,
}

class Circle {
    radius: f64,
}

tests "is operator" {
    test "primitive types" {
        let i = 42          // defaults to i64
        let f = 3.14
        let s = "hello"
        let b = true
        let n = nil

        assert(i is i64)    // 42 is i64 by default
        assert(f is f64)
        assert(s is string)
        assert(b is bool)
        assert(n is nil)
    }

    test "explicit types" {
        let i: i32 = 42
        let j: i64 = 100

        assert(i is i32)
        assert(j is i64)
        assert(!(i is i64))
        assert(!(j is i32))
    }

    test "negative checks" {
        let i = 42
        let s = "hello"

        assert(!(i is string))
        assert(!(s is i64))
        assert(!(i is nil))
        assert(!(s is bool))
    }

    test "class instances" {
        let p = Point { x: 10, y: 20 }
        let c = Circle { radius: 5.0 }

        assert(p is Point)
        assert(c is Circle)
        assert(!(p is Circle))
        assert(!(c is Point))
    }

    // TODO: arrays - needs `is Array` or similar type check
    // test "arrays" {
    //     let arr = [1, 2, 3]
    //     let num = 42
    //     assert(arr is Array<i64>)
    //     assert(!(num is Array<i64>))
    // }

    // TODO: functions - needs function type checking
    // test "functions" {
    //     let f = (x: i32) => x * 2
    //     let num = 42
    //     assert(f is function)
    //     assert(!(num is function))
    // }

    test "in conditionals" {
        let x = 42
        let result = if x is i64 { "integer" } else { "other" }
        assert(result == "integer")

        let s = "hello"
        let result2 = if s is i64 { "integer" } else { "string" }
        assert(result2 == "string")
    }
}
