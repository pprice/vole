// Test functions as first-class values (vole-s44)

// Helper functions for testing
func double(x: i64) -> i64 {
    return x * 2
}

func triple(x: i64) -> i64 {
    return x * 3
}

func add_one(x: i64) -> i64 {
    return x + 1
}

func is_even(x: i64) -> bool {
    return x % 2 == 0
}

// Higher-order function for apply
func apply(f: (i64) -> i64, x: i64) -> i64 {
    return f(x)
}

tests "function values" {
    test "pass named function to higher-order function" {
        // Named functions can be passed as values
        assert(apply(double, 5) == 10)
        assert(apply(triple, 5) == 15)
        assert(apply(add_one, 5) == 6)
    }

    test "store function in variable" {
        // Named functions can be stored in variables
        let f = double
        assert(f(10) == 20)
    }

    test "function passed to map" {
        // Named functions work with iterator methods
        let arr = [1, 2, 3]
        let result = arr.iter().map(double).collect()
        assert(result[0] == 2)
        assert(result[1] == 4)
        assert(result[2] == 6)
    }

    test "function passed to filter" {
        let arr = [1, 2, 3, 4, 5, 6]
        let evens = arr.iter().filter(is_even).collect()
        assert(evens[0] == 2)
        assert(evens[1] == 4)
        assert(evens[2] == 6)
    }

    test "compare with lambda" {
        // Named function should behave like lambda
        let arr = [1, 2, 3]
        let with_named = arr.iter().map(double).collect()
        let with_lambda = arr.iter().map((x) => x * 2).collect()
        assert(with_named[0] == with_lambda[0])
        assert(with_named[1] == with_lambda[1])
        assert(with_named[2] == with_lambda[2])
    }
}
