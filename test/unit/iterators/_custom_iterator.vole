// Test: custom Iterator<T> implementations â€” collect, count, string iterators.
//
// DO NOT SIMPLIFY this test.

class Counter {
    current: i64,
    max: i64,
}

extend Counter with Iterator<i64> {
    func next() -> i64 | Done {
        if self.current >= self.max {
            return Done {}
        }
        let v = self.current
        self.current = self.current + 1
        return v
    }
}

class WordIter {
    index: i64,
    words: [string],
}

extend WordIter with Iterator<string> {
    func next() -> string | Done {
        if self.index >= self.words.length() {
            return Done {}
        }
        let w = self.words[self.index]
        self.index = self.index + 1
        return w
    }
}

tests "custom Iterator<T>" {
    test "custom iterator collect" {
        let c = Counter { current: 1, max: 4 }
        let items = c.collect()
        assert(items.length() == 3)
        assert(items[0] == 1)
        assert(items[1] == 2)
        assert(items[2] == 3)
    }

    test "custom iterator count" {
        let c = Counter { current: 0, max: 5 }
        assert(c.count() == 5)
    }

    test "custom string iterator collect" {
        let w = WordIter { index: 0, words: ["a", "b", "c"] }
        let all = w.collect()
        assert(all.length() == 3)
        assert(all[0] == "a")
        assert(all[2] == "c")
    }
}
