// Regression test: Iterable<T> default methods on a user-defined type from a
// separate module. The interface declaration lives in stdlib, not the user module.
// Codegen must search stdlib programs (not just the current program) to find
// default method bodies.
//
// Tracked: vol-yq3y
let helper = import "./iterable_cross_module_helper"

tests "cross-module user-defined iterable: default methods" {
    test "count via cross-module Iterable" {
        let r = helper.make_range(0, 5)
        assert(r.count() == 5)
    }

    test "collect via cross-module Iterable" {
        let r = helper.make_range(1, 4)
        let arr = r.collect()
        assert(arr.length() == 3)
        assert(arr[0] == 1)
        assert(arr[1] == 2)
        assert(arr[2] == 3)
    }

    test "sum via cross-module Iterable" {
        let r = helper.make_range(1, 6)
        assert(r.sum() == 15)
    }

    test "map collect via cross-module Iterable" {
        let r = helper.make_range(1, 4)
        let doubled = r.map((x) => x * 2).collect()
        assert(doubled.length() == 3)
        assert(doubled[0] == 2)
        assert(doubled[1] == 4)
        assert(doubled[2] == 6)
    }

    test "filter collect via cross-module Iterable" {
        let r = helper.make_range(0, 6)
        let evens = r.filter((x) => x % 2 == 0).collect()
        assert(evens.length() == 3)
        assert(evens[0] == 0)
        assert(evens[1] == 2)
        assert(evens[2] == 4)
    }
}
